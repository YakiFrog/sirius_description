<?xml version="1.0"?>
<!-- Sirius3ロボットモデルのSDFファイル -->
<sdf version="1.9">
  <model name="sirius3">

    <!-- Base Footprint - ダミーリンク（質量なし） -->
    <link name="base_footprint">
      <!-- 空の慣性要素を持たないリンク（地面に接触する仮想的なリンク） -->
    </link>

    <!-- Base Link -->
    <link name="base_link">
      <pose>0 0 0 0 0 0</pose>
      <inertial>
        <pose>-0.15 0 0 0 0 0</pose> <!-- 慣性の原点を15cm後ろにずらす -->
        <mass>55.93</mass>
        <inertia>
          <ixx>5.0</ixx>
          <ixy>0.000982314201767401</ixy>
          <ixz>-0.0034301184728964904</ixz>
          <iyy>4.5</iyy>
          <iyz>0.26295068207750116</iyz>
          <izz>2.1448545974410616</izz>
        </inertia>
      </inertial>
      <visual name="base_visual">
        <geometry>
          <mesh>
            <uri>file:///home/kotantu-desktop/sirius_jazzy_ws/src/sirius_description/urdf/meshes/Sirius3-body-v2.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <material>
          <ambient>0.1 0.3 0.6 1</ambient>
          <diffuse>0.1 0.3 0.6 1</diffuse>
          <specular>0.2 0.4 0.8 1</specular>
        </material>
      </visual>
      <collision name="base_collision">
        <geometry>
          <mesh>
            <uri>file:///home/kotantu-desktop/sirius_jazzy_ws/src/sirius_description/urdf/meshes/Sirius3-body-v2.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <!-- 摩擦 -->
        /// <summary>
        /// 摩擦係数の目安:
        /// 0.0 = 完全に滑る（氷のような状態）
        /// 0.8 = かなり高い摩擦（ゴムと乾いたコンクリートに近い）
        /// 1.0 = 非常に高い摩擦
        /// 1.5以上 = 極めて高い摩擦
        /// </summary>
        <surface>
          <friction>
            <ode>
              <mu>0.5</mu> <!-- すべり方向への摩擦係数 -->
              <mu2>0.8</mu2> <!-- 法線方向への摩擦係数 -->
            </ode>
          </friction>
        </surface>
      </collision>

      <!-- LiDAR センサー(Velodyne) -->
      <sensor name="lidar_link" type="gpu_lidar">
          <pose>0 0 0.85 0 0 0</pose>
          <topic>scan</topic>
          <update_rate>10</update_rate>
          <lidar>
              <scan>
                  <horizontal>
                      <samples>360</samples>
                      <resolution>1</resolution>
                      <min_angle>-3.14159</min_angle>
                      <max_angle>3.14159</max_angle>
                  </horizontal>
              </scan>
              <range>
                  <min>0.1</min>
                  <max>100.0</max>
                  <resolution>0.01</resolution>
              </range>
              <noise>
                  <type>gaussian</type>
                  <mean>0.0</mean>
                  <stddev>0.01</stddev>
              </noise>
          </lidar>
          <visualize>true</visualize>
          <always_on>1</always_on>
      </sensor>


      <!-- LiDAR センサー2(Hokuyo)-->
      <sensor name="lidar_link2" type="gpu_lidar">
          <pose>0.25 0.0 0.17 0 0 0</pose>
          <topic>hokuyo_scan</topic>
          <update_rate>40</update_rate>
          <lidar>
              <scan>
                  <horizontal>
                      <samples>360</samples>
                      <resolution>1</resolution>
                      <min_angle>-1.5708</min_angle>
                      <max_angle>1.5708</max_angle>
                  </horizontal>
              </scan>
              <range>
                  <min>0.1</min>
                  <max>30.0</max>
                  <resolution>0.001</resolution>
              </range>
              <noise>
                  <type>gaussian</type>
                  <mean>0.0</mean>
                  <stddev>0.01</stddev>
              </noise>
          </lidar>
          <visualize>true</visualize>
          <always_on>1</always_on>
      </sensor>
    </link>

    <!-- Left Wheel -->
    <link name="left_wheel">

      <pose relative_to="base_link">0.0 0.16 0.13 -3.141592653589793 -1.5707963267948966 0</pose>
      <inertial>
        <pose>0.0 0.0 0.021535 0 0 0</pose>
        <mass>26.684250609189966</mass>
        <inertia>
          <ixx>0.13041983338763763</ixx>
          <ixy>-1.9456112928552954e-05</ixy>
          <ixz>-5.293518847926393e-06</ixz>
          <iyy>0.13040791997952428</iyy>
          <iyz>1.3386522533801598e-05</iyz>
          <izz>0.24147472596060549</izz>
        </inertia>
      </inertial>
      <visual name="left_wheel_visual">
        <pose relative_to="left_wheel">0 0 0 -3.141592653589793 -1.5707963267948966 0</pose>
        <geometry>
          <mesh>
            <uri>file:///home/kotantu-desktop/sirius_jazzy_ws/src/sirius_description/urdf/meshes/Left-Wheel-v1.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <material>
          <ambient>0.3 0.3 0.3 1</ambient>
          <diffuse>0.3 0.3 0.3 1</diffuse>
          <specular>0.15 0.15 0.15 1</specular>
        </material>
      </visual>
      <collision name="left_wheel_collision">
        <pose relative_to="left_wheel">0 0 0 -3.141592653589793 -1.5707963267948966 0</pose>
        <geometry>
          <mesh>
            <uri>file:///home/kotantu-desktop/sirius_jazzy_ws/src/sirius_description/urdf/meshes/Left-Wheel-v1.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>1.5</mu>
              <mu2>1.5</mu2>
            </ode>
          </friction>
        </surface>
      </collision>
    </link>

    <!-- Right Wheel -->
    <link name="right_wheel">
      <pose relative_to="base_link">0.0 -0.16 0.13 0.0 -1.5707963267948966 0</pose>
      <inertial>
        <pose>0.0 0.0 0.021535 0 0 0</pose>
        <mass>26.680591288269447</mass>
        <inertia>
          <ixx>0.1304158303609999</ixx>
          <ixy>-8.207010673684685e-06</ixy>
          <ixz>-1.3876354790554046e-05</ixz>
          <iyy>0.1303611813000909</iyy>
          <iyz>1.4294269790344344e-06</iyz>
          <izz>0.24143130580426014</izz>
        </inertia>
      </inertial>
      <visual name="right_wheel_visual">
        <pose relative_to="right_wheel">0 0 0 0 1.5707963267948966 0</pose>
        <geometry>
          <mesh>
            <uri>file:///home/kotantu-desktop/sirius_jazzy_ws/src/sirius_description/urdf/meshes/Right-Wheel-v1.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <material>
          <ambient>0.3 0.3 0.3 1</ambient>
          <diffuse>0.3 0.3 0.3 1</diffuse>
          <specular>0.15 0.15 0.15 1</specular>
        </material>
      </visual>
      <collision name="right_wheel_collision">
        <pose relative_to="right_wheel">0 0 0 0 1.5707963267948966 0</pose>
        <geometry>
          <mesh>
            <uri>file:///home/kotantu-desktop/sirius_jazzy_ws/src/sirius_description/urdf/meshes/Right-Wheel-v1.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>1.5</mu>
              <mu2>1.5</mu2>
            </ode>
          </friction>
        </surface>
      </collision>
    </link>

    <!-- LiDAR Link -->
    <link name="lidar_link">
      <pose relative_to="base_link">0 0 0.85 0 0 0</pose>
      <inertial>
        <mass>0.5</mass>
        <inertia>
          <ixx>0.01</ixx>
          <ixy>0</ixy>
          <ixz>0</ixz>
          <iyy>0.01</iyy>
          <iyz>0</iyz>
          <izz>0.01</izz>
        </inertia>
      </inertial>
      <visual name="lidar_visual">
        <geometry>
          <cylinder>
            <radius>0.052</radius>
            <length>0.072</length>
          </cylinder>
        </geometry>
        <material>
          <ambient>0.2 0.2 0.2 1</ambient>
          <diffuse>0.2 0.2 0.2 1</diffuse>
          <specular>0.1 0.1 0.1 1</specular>
        </material>
      </visual>
      <collision name="lidar_collision">
        <geometry>
          <cylinder>
            <radius>0.052</radius>
            <length>0.072</length>
          </cylinder>
        </geometry>
      </collision>
    </link>

    <!-- Joints -->
    <!-- フットプリントとベースを接続するジョイント -->
    <joint name="footprint_to_base" type="fixed">
      <parent>base_footprint</parent>
      <child>base_link</child>
      <pose>0 0 0 0 0 0</pose>
    </joint>

    <joint name="left_wheel_joint" type="revolute">
      <parent>base_link</parent>
      <child>left_wheel</child>
      <axis>
        <xyz>0 -1 0</xyz>
        <limit>
          <effort>100</effort>
          <velocity>100</velocity>
        </limit>
        <dynamics>
          <damping>5.0</damping>
          <friction>2.0</friction>
        </dynamics>
      </axis>
    </joint>

    <joint name="right_wheel_joint" type="revolute">
      <parent>base_link</parent>
      <child>right_wheel</child>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <effort>100</effort>
          <velocity>100</velocity>
        </limit>
        <dynamics>
          <damping>5.0</damping>
          <friction>2.0</friction>
        </dynamics>
      </axis>
    </joint>

    <!-- LiDAR Joint -->
    <joint name="lidar_joint" type="fixed">
      <parent>base_link</parent>
      <child>lidar_link</child>
    </joint>

    <!-- Differential Drive Plugin -->
    <plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
      <topic>cmd_vel</topic>    <!-- 速度指令のトピック名 -->
      <left_joint>left_wheel_joint</left_joint>    <!-- 左車輪のジョイント名 -->
      <right_joint>right_wheel_joint</right_joint>    <!-- 右車輪のジョイント名 -->
      <wheel_separation>0.30</wheel_separation>    <!-- 車輪間距離 -->
      <wheel_radius>0.0825</wheel_radius>    <!-- 車輪半径 -->
      <odom_publish_frequency>50</odom_publish_frequency>    <!-- Odometry公開の頻度 -->
    </plugin>

    <!-- joint pub -->
    <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
      <topic>joint_states</topic>
      <!-- プレフィックスを追加 -->
      <frame_prefix>sirius3/</frame_prefix>
      <!-- 対象ジョイント名 -->
      <joint_name>left_wheel_joint</joint_name>
      <joint_name>right_wheel_joint</joint_name>
    </plugin>
    
  </model>
</sdf>